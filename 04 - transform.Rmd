---
title: "Transform Data"
---

# Import Data

## Your turn 1

```{r Your Turn 1}
library(tidyverse)  # Provides functions used throughout this session

covid_testing <- read_csv("data/covid_testing.csv")
```

How can you confirm that you have successfully loaded the data file into Rstudio?

	1. The code that imported the data did not yield an error
	2. Code that references `covid_testing` object runs without errors
	3. The `covid_testing` object is present in the environment pane
	4. All of the above

## select()

```{r}
select(covid_testing, mrn, last_name)
select(covid_testing, c(1,3))
```

## Your turn 2

1. Alter the code to select just the `first_name` column.
2. Assign the result to covid_testing_2
3. If you have time, see if you can use a

```{r Your Turn 2}
# Remove the "_______" and replace it with your answer
covid_testing_2 <- select(covid_testing, ________)
```

## Your Turn 3

The turnaround time metrics are found in columns 16 and 17 and are labeled `col_rec_tat` and `rec_var_tat`. Which of these could you use to remove these columns?

```{r Your Turn 3}
select(covid_testing, -16,-17)
select(covid_testing, -col_rec_tat, -rec_ver_tat)
select(covid_testing, -contains("tat"))
#all of the above
```

## filter()

```{r}
filter(covid_testing, mrn == 5000078)
```

```{r}
filter(covid_testing, last_name=="stark")
```

## Your turn 4

Use the 3 code blocks below, and `filter()`, to show how you would filter the `covid_testing` dataset.

Modify the code in this block to find:

1. Every test for patients over age 80
```{r covid_testing_4a}
filter(covid_testing, ________)
```

2. All of the covid testing where the demographic group (demo_group) is equal to "client"
```{r covid_testing_4b}

```

3. CHALLENGE: All of the covid testing where the patient class (patient_class) is NA [Hint: See slide titled "Logical Tests"]
```{r covid_testing_4c}

```


## Arrange

```{r}
arrange(covid_testing, patient_id)
```

## Your turn 5

1. Arrange covid_testing by `order_status_c_descr` and assign the output covid_testing_5. 
What order statuses appear in the top rows of the data frame?

2. Add `order_class_c_descr` as a second (tie breaking) column to arrange on, but order it in reverse alphabetical order. 
What type of order class appears in the first rows of the data frame? Based on the description column, to what type of lab test does this order class seem to relate to?

```{r}

```


## Steps and the pipe

```{r}
VITD <- covid_testing %>%
		 filter(description == "1,25 DIHYDROXY VITAMIN D") %>%
		 select(department, ordering_route, pref_list_type) %>%
		 arrange(department)
VITD
```

## Your turn 6

Use `%>%` to write a sequence of functions that: 

1. Filters to covid_testing coming from the `department` "BEHAVIORAL HEALTH CLINIC" (case-sensitive)
2. Selects the `description`, `ordering_route`, and `pref_list_type` columns  
3. Arrange the dataset by the `description` and `ordering_route` column.

Assign the output to a new variable (covid_testing_6).

CHALLENGE: Use your mouse to select the name of the new data frame from the list of data sets in the upper-right pane of Rstudio. Do you notice any interesting test ordering patterns?

```{r}
covid_testing_6 <- covid_testing %>% 
  filter() %>% 
  select() %>% 
  arrange()
```


## mutate

```{r}
covid_testing %>%
	mutate(coded_order_id = order_id/2)
```

## Your turn 7

The weekdays() function will return the weekday for any date.

1. Use the weekdays() function to make a new column which contains the day of the week that each order was placed.
2. Then select this new column and the order_time column.
3. Assign the result to a new variable covid_testing_7


```{r}

```


## Replace a column with `mutate()`

```{r}
covid_testing %>%
	mutate(order_id = as.character(order_id))
```

## Conditionally replace values in a column with `mutate()`

```{r}
covid_testing %>%
	mutate(proc_code = ifelse(proc_code %in% c("CBC","CBD"), 
	                          "CBC", 
	                          proc_code)) 
```

## Final Challenge

The pref_list_type column has values of either "Clinic Preference List", "Provider Preference List", or "None".

1. Conditionally replace these with "clinic", "provider", and NA, respectively.

```{r}

```


# Take aways

* Extract variables with `select()`  
* Extract cases with `filter()`  
* Arrange cases, with `arrange()`  

* Make new variables, with `mutate()`  

* Connect operations with `%>%`  

